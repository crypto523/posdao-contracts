---
id: RandomAuRa
title: RandomAuRa
---

<div class="contract-doc"><div class="contract"><h2 class="contract-header"><span class="contract-kind">contract</span> RandomAuRa</h2><p class="base-contracts"><span>is</span> <a href="abstracts_RandomBase.html">RandomBase</a><span>, </span><a href="interfaces_IRandomAuRa.html">IRandomAuRa</a></p><p class="description">Generates and stores random numbers in a RANDAO manner (and controls when they are revealed by AuRa validators) and accumulates a random seed. The random seed is used to form a new validator set by the `ValidatorSet._newValidatorSet` function.</p><div class="source">Source: <a href="https://github.com/poanetwork/posdao-contracts/blob/v0.1.0/contracts/RandomAuRa.sol" target="_blank">contracts/RandomAuRa.sol</a></div></div><div class="index"><h2>Index</h2><ul><li><a href="RandomAuRa.html#collectRoundLength">collectRoundLength</a></li><li><a href="RandomAuRa.html#commitHash">commitHash</a></li><li><a href="RandomAuRa.html#commitHashCallable">commitHashCallable</a></li><li><a href="RandomAuRa.html#commitPhaseLength">commitPhaseLength</a></li><li><a href="RandomAuRa.html#currentCollectRound">currentCollectRound</a></li><li><a href="RandomAuRa.html#getCipher">getCipher</a></li><li><a href="RandomAuRa.html#getCommit">getCommit</a></li><li><a href="RandomAuRa.html#initialize">initialize</a></li><li><a href="RandomAuRa.html#isCommitPhase">isCommitPhase</a></li><li><a href="RandomAuRa.html#isCommitted">isCommitted</a></li><li><a href="RandomAuRa.html#isRevealPhase">isRevealPhase</a></li><li><a href="RandomAuRa.html#onFinishCollectRound">onFinishCollectRound</a></li><li><a href="RandomAuRa.html#onlyBlockReward">onlyBlockReward</a></li><li><a href="RandomAuRa.html#revealSecret">revealSecret</a></li><li><a href="RandomAuRa.html#revealSecretCallable">revealSecretCallable</a></li><li><a href="RandomAuRa.html#revealSkips">revealSkips</a></li><li><a href="RandomAuRa.html#sentReveal">sentReveal</a></li></ul></div><div class="reference"><h2>Reference</h2><div class="modifiers"><h3>Modifiers</h3><ul><li><div class="item modifier"><span id="onlyBlockReward" class="anchor-marker"></span><h4 class="name">onlyBlockReward</h4><div class="body"><code class="signature">modifier <strong>onlyBlockReward</strong><span>() </span></code><hr/><div class="description"><p>Ensures the caller is the BlockRewardAuRa contract address (EternalStorageProxy proxy contract for BlockRewardAuRa).</p></div></div></div></li></ul></div><div class="functions"><h3>Functions</h3><ul><li><div class="item function"><span id="collectRoundLength" class="anchor-marker"></span><h4 class="name">collectRoundLength</h4><div class="body"><code class="signature">function <strong>collectRoundLength</strong><span>() </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the length of the collection round (in blocks).</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="commitHash" class="anchor-marker"></span><h4 class="name">commitHash</h4><div class="body"><code class="signature">function <strong>commitHash</strong><span>(bytes32 _secretHash, bytes _cipher) </span><span>external </span></code><hr/><div class="description"><p>Called by the validator&#x27;s node to store a hash and a cipher of the validator&#x27;s secret on each collection round. The validator&#x27;s node must use its mining address to call this function. This function can only be called once per collection round (during the `commits phase`).</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_secretHash</code> - The Keccak-256 hash of the validator&#x27;s secret.</div><div><code>_cipher</code> - The cipher of the validator&#x27;s secret. Can be used by the node to restore the lost secret after the node is restarted (see the `getCipher` getter).</div></dd></dl></div></div></li><li><div class="item function"><span id="commitHashCallable" class="anchor-marker"></span><h4 class="name">commitHashCallable</h4><div class="body"><code class="signature">function <strong>commitHashCallable</strong><span>(address _miningAddress, bytes32 _secretHash) </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag of whether the `commitHash` function can be called at the current block by the specified validator. Used by the `commitHash` function and the `TxPermission` contract.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_miningAddress</code> - The mining address of the validator which tries to call the `commitHash` function.</div><div><code>_secretHash</code> - The Keccak-256 hash of validator&#x27;s secret passed to the `commitHash` function.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li><li><div class="item function"><span id="commitPhaseLength" class="anchor-marker"></span><h4 class="name">commitPhaseLength</h4><div class="body"><code class="signature">function <strong>commitPhaseLength</strong><span>() </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the length of the commits/reveals phase which is always half of the collection round length.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="currentCollectRound" class="anchor-marker"></span><h4 class="name">currentCollectRound</h4><div class="body"><code class="signature">function <strong>currentCollectRound</strong><span>() </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the serial number of the current collection round.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="getCipher" class="anchor-marker"></span><h4 class="name">getCipher</h4><div class="body"><code class="signature">function <strong>getCipher</strong><span>(uint256 _collectRound, address _miningAddress) </span><span>public </span><span>view </span><span>returns  (bytes) </span></code><hr/><div class="description"><p>Returns the cipher of the validator&#x27;s secret for the specified collection round and the specified validator stored by the validator through the `commitHash` function.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_collectRound</code> - The serial number of the collection round for which the cipher should be retrieved.</div><div><code>_miningAddress</code> - The mining address of validator.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bytes</dd></dl></div></div></li><li><div class="item function"><span id="getCommit" class="anchor-marker"></span><h4 class="name">getCommit</h4><div class="body"><code class="signature">function <strong>getCommit</strong><span>(uint256 _collectRound, address _miningAddress) </span><span>public </span><span>view </span><span>returns  (bytes32) </span></code><hr/><div class="description"><p>Returns the Keccak-256 hash of the validator&#x27;s secret for the specified collection round and the specified validator stored by the validator through the `commitHash` function.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_collectRound</code> - The serial number of the collection round for which the hash should be retrieved.</div><div><code>_miningAddress</code> - The mining address of validator.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bytes32</dd></dl></div></div></li><li><div class="item function"><span id="initialize" class="anchor-marker"></span><h4 class="name">initialize</h4><div class="body"><code class="signature">function <strong>initialize</strong><span>(uint256 _collectRoundLength) </span><span>external </span></code><hr/><div class="description"><p>Initializes the contract at network startup. Must be called by the constructor of the `InitializerAuRa` contract on the genesis block.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_collectRoundLength</code> - The length of a collection round in blocks.</div></dd></dl></div></div></li><li><div class="item function"><span id="isCommitPhase" class="anchor-marker"></span><h4 class="name">isCommitPhase</h4><div class="body"><code class="signature">function <strong>isCommitPhase</strong><span>() </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag indicating whether the current phase of the current collection round is a `commits phase`. Used by the validator&#x27;s node to determine if it should commit the hash of the secret during the current collection round.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li><li><div class="item function"><span id="isCommitted" class="anchor-marker"></span><h4 class="name">isCommitted</h4><div class="body"><code class="signature">function <strong>isCommitted</strong><span>(uint256 _collectRound, address _miningAddress) </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag indicating whether the specified validator has committed their secret&#x27;s hash for the specified collection round.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_collectRound</code> - The serial number of the collection round for which the checkup should be done.</div><div><code>_miningAddress</code> - The mining address of the validator.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li><li><div class="item function"><span id="isRevealPhase" class="anchor-marker"></span><h4 class="name">isRevealPhase</h4><div class="body"><code class="signature">function <strong>isRevealPhase</strong><span>() </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag indicating whether the current phase of the current collection round is a `reveals phase`. Used by the validator&#x27;s node to determine if it should reveal the secret during the current collection round.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li><li><div class="item function"><span id="onFinishCollectRound" class="anchor-marker"></span><h4 class="name">onFinishCollectRound</h4><div class="body"><code class="signature">function <strong>onFinishCollectRound</strong><span>() </span><span>external </span></code><hr/><div class="description"><p>Checks whether the current validators at the end of each collection round revealed their secrets, and removes malicious validators if needed. This function does nothing if the current block is not the last block of the current collection round. Can only be called by the `BlockRewardAuRa` contract (its `reward` function).</p></div><dl><dt><span class="label-modifiers">Modifiers:</span></dt><dd><a href="RandomAuRa.html#onlyBlockReward">onlyBlockReward </a></dd></dl></div></div></li><li><div class="item function"><span id="revealSecret" class="anchor-marker"></span><h4 class="name">revealSecret</h4><div class="body"><code class="signature">function <strong>revealSecret</strong><span>(uint256 _secret) </span><span>external </span></code><hr/><div class="description"><p>Called by the validator&#x27;s node to XOR its secret with the current random seed. The validator&#x27;s node must use its mining address to call this function. This function can only be called once per collection round (during the `reveals phase`).</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_secret</code> - The validator&#x27;s secret.</div></dd></dl></div></div></li><li><div class="item function"><span id="revealSecretCallable" class="anchor-marker"></span><h4 class="name">revealSecretCallable</h4><div class="body"><code class="signature">function <strong>revealSecretCallable</strong><span>(address _miningAddress, uint256 _secret) </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag of whether the `revealSecret` function can be called at the current block by the specified validator. Used by the `revealSecret` function and the `TxPermission` contract.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_miningAddress</code> - The mining address of validator which tries to call the `revealSecret` function.</div><div><code>_secret</code> - The validator&#x27;s secret passed to the `revealSecret` function.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li><li><div class="item function"><span id="revealSkips" class="anchor-marker"></span><h4 class="name">revealSkips</h4><div class="body"><code class="signature">function <strong>revealSkips</strong><span>(uint256 _stakingEpoch, address _miningAddress) </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the number of reveal skips made by the specified validator during the specified staking epoch.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_stakingEpoch</code> - The serial number of the staking epoch for which the number of skips should be returned.</div><div><code>_miningAddress</code> - The mining address of the validator for which the number of skips should be returned.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="sentReveal" class="anchor-marker"></span><h4 class="name">sentReveal</h4><div class="body"><code class="signature">function <strong>sentReveal</strong><span>(uint256 _collectRound, address _miningAddress) </span><span>public </span><span>view </span><span>returns  (bool) </span></code><hr/><div class="description"><p>Returns a boolean flag of whether the specified validator has revealed their secret for the specified collection round.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_collectRound</code> - The serial number of the collection round for which the checkup should be done.</div><div><code>_miningAddress</code> - The mining address of the validator.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>bool</dd></dl></div></div></li></ul></div></div></div>
