---
id: ValidatorSetAuRa
title: ValidatorSetAuRa
---

<div class="contract-doc"><div class="contract"><h2 class="contract-header"><span class="contract-kind">contract</span> ValidatorSetAuRa</h2><p class="base-contracts"><span>is</span> <a href="interfaces_IValidatorSetAuRa.html">IValidatorSetAuRa</a><span>, </span><a href="abstracts_ValidatorSetBase.html">ValidatorSetBase</a></p><p class="description">Stores the current validator set and contains the logic for choosing new validators at the beginning of each staking epoch. The logic uses a random seed generated and stored by the `RandomAuRa` contract.</p><div class="source">Source: <a href="https://github.com/poanetwork/posdao-contracts/blob/v0.1.0/contracts/ValidatorSetAuRa.sol" target="_blank">contracts/ValidatorSetAuRa.sol</a></div></div><div class="index"><h2>Index</h2><ul><li><a href="ValidatorSetAuRa.html#ReportedMalicious">ReportedMalicious</a></li><li><a href="ValidatorSetAuRa.html#_banStart">_banStart</a></li><li><a href="ValidatorSetAuRa.html#_banUntil">_banUntil</a></li><li><a href="ValidatorSetAuRa.html#_clearReportingCounter">_clearReportingCounter</a></li><li><a href="ValidatorSetAuRa.html#_incrementReportingCounter">_incrementReportingCounter</a></li><li><a href="ValidatorSetAuRa.html#_removeMaliciousValidatorAuRa">_removeMaliciousValidatorAuRa</a></li><li><a href="ValidatorSetAuRa.html#maliceReportedForBlock">maliceReportedForBlock</a></li><li><a href="ValidatorSetAuRa.html#newValidatorSet">newValidatorSet</a></li><li><a href="ValidatorSetAuRa.html#onlyBlockRewardContract">onlyBlockRewardContract</a></li><li><a href="ValidatorSetAuRa.html#onlyRandomContract">onlyRandomContract</a></li><li><a href="ValidatorSetAuRa.html#removeMaliciousValidator">removeMaliciousValidator</a></li><li><a href="ValidatorSetAuRa.html#reportMalicious">reportMalicious</a></li><li><a href="ValidatorSetAuRa.html#reportMaliciousCallable">reportMaliciousCallable</a></li><li><a href="ValidatorSetAuRa.html#reportingCounter">reportingCounter</a></li><li><a href="ValidatorSetAuRa.html#reportingCounterTotal">reportingCounterTotal</a></li></ul></div><div class="reference"><h2>Reference</h2><div class="events"><h3>Events</h3><ul><li><div class="item event"><span id="ReportedMalicious" class="anchor-marker"></span><h4 class="name">ReportedMalicious</h4><div class="body"><code class="signature">event <strong>ReportedMalicious</strong><span>(address reportingValidator, address maliciousValidator, uint256 blockNumber) </span></code><hr/><div class="description"><p>Emitted by the `reportMalicious` function to signal that a specified validator reported misbehavior by a specified malicious validator at a specified block number.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>reportingValidator</code> - The mining address of the reporting validator.</div><div><code>maliciousValidator</code> - The mining address of the malicious validator.</div><div><code>blockNumber</code> - The block number at which the `maliciousValidator` misbehaved.</div></dd></dl></div></div></li></ul></div><div class="modifiers"><h3>Modifiers</h3><ul><li><div class="item modifier"><span id="onlyBlockRewardContract" class="anchor-marker"></span><h4 class="name">onlyBlockRewardContract</h4><div class="body"><code class="signature">modifier <strong>onlyBlockRewardContract</strong><span>() </span></code><hr/><div class="description"><p>Ensures the caller is the BlockRewardAuRa contract address (EternalStorageProxy proxy contract for the BlockRewardAuRa).</p></div></div></div></li><li><div class="item modifier"><span id="onlyRandomContract" class="anchor-marker"></span><h4 class="name">onlyRandomContract</h4><div class="body"><code class="signature">modifier <strong>onlyRandomContract</strong><span>() </span></code><hr/><div class="description"><p>Ensures the caller is the RandomAuRa contract address (EternalStorageProxy proxy contract for the RandomAuRa).</p></div></div></div></li></ul></div><div class="functions"><h3>Functions</h3><ul><li><div class="item function"><span id="_banStart" class="anchor-marker"></span><h4 class="name">_banStart</h4><div class="body"><code class="signature">function <strong>_banStart</strong><span>() </span><span>internal </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the current block number for the `isValidatorBanned`, `_banUntil`, and `_banValidator` functions.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="_banUntil" class="anchor-marker"></span><h4 class="name">_banUntil</h4><div class="body"><code class="signature">function <strong>_banUntil</strong><span>() </span><span>internal </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the future block number until which a validator is banned. Used by the `_banValidator` function.</p></div><dl><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="_clearReportingCounter" class="anchor-marker"></span><h4 class="name">_clearReportingCounter</h4><div class="body"><code class="signature">function <strong>_clearReportingCounter</strong><span>(address _miningAddress) </span><span>internal </span></code><hr/><div class="description"><p>Updates the total reporting counter (see the `reportingCounterTotal` getter) for the current staking epoch after the specified validator is removed as malicious. The `reportMaliciousCallable` getter uses this counter for reporting checks so it must be up-to-date. Called by the `_removeMaliciousValidatorAuRa` internal function.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_miningAddress</code> - The mining address of the removed malicious validator.</div></dd></dl></div></div></li><li><div class="item function"><span id="_incrementReportingCounter" class="anchor-marker"></span><h4 class="name">_incrementReportingCounter</h4><div class="body"><code class="signature">function <strong>_incrementReportingCounter</strong><span>(address _reportingMiningAddress) </span><span>internal </span></code><hr/><div class="description"><p>Increments the reporting counter for the specified validator and the current staking epoch. See the `reportingCounter` and `reportingCounterTotal` getters. Called by the `reportMalicious` function when the validator reports a misbehavior.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_reportingMiningAddress</code> - The mining address of reporting validator.</div></dd></dl></div></div></li><li><div class="item function"><span id="_removeMaliciousValidatorAuRa" class="anchor-marker"></span><h4 class="name">_removeMaliciousValidatorAuRa</h4><div class="body"><code class="signature">function <strong>_removeMaliciousValidatorAuRa</strong><span>(address _miningAddress) </span><span>internal </span></code><hr/><div class="description"><p>Removes the specified validator as malicious from the pending validator set and enqueues the updated pending validator set to be dequeued by the `emitInitiateChange` function. Does nothing if the specified validator is already banned, non-removable, or does not exist in the pending validator set.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_miningAddress</code> - The mining address of the malicious validator.</div></dd></dl></div></div></li><li><div class="item function"><span id="maliceReportedForBlock" class="anchor-marker"></span><h4 class="name">maliceReportedForBlock</h4><div class="body"><code class="signature">function <strong>maliceReportedForBlock</strong><span>(address _maliciousMiningAddress, uint256 _blockNumber) </span><span>public </span><span>view </span><span>returns  (address[]) </span></code><hr/><div class="description"><p>Returns an array of the validators (their mining addresses) which reported that the specified malicious validator misbehaved at the specified block.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_maliciousMiningAddress</code> - The mining address of the malicious validator.</div><div><code>_blockNumber</code> - The block number at which the misbehavior was observed.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>address[]</dd></dl></div></div></li><li><div class="item function"><span id="newValidatorSet" class="anchor-marker"></span><h4 class="name">newValidatorSet</h4><div class="body"><code class="signature">function <strong>newValidatorSet</strong><span>() </span><span>external </span><span>returns  (bool, uint256) </span></code><hr/><div class="description"><p>Implements the logic which forms a new validator set. Calls the internal `_newValidatorSet` function of the base contract. Automatically called by the `BlockRewardAuRa.reward` function on every block.</p></div><dl><dt><span class="label-modifiers">Modifiers:</span></dt><dd><a href="ValidatorSetAuRa.html#onlyBlockRewardContract">onlyBlockRewardContract </a></dd><dt><span class="label-return">Returns:</span></dt><dd>poolsToBeElectedLength The number of pools ready to be elected (see the `Staking.getPoolsToBeElected` function). Equals `0` if the `called` flag is `false`.</dd></dl></div></div></li><li><div class="item function"><span id="removeMaliciousValidator" class="anchor-marker"></span><h4 class="name">removeMaliciousValidator</h4><div class="body"><code class="signature">function <strong>removeMaliciousValidator</strong><span>(address _miningAddress) </span><span>external </span></code><hr/><div class="description"><p>Removes a malicious validator. Called by the `RandomAuRa.onFinishCollectRound` function.</p></div><dl><dt><span class="label-modifiers">Modifiers:</span></dt><dd><a href="ValidatorSetAuRa.html#onlyRandomContract">onlyRandomContract </a></dd><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_miningAddress</code> - The mining address of the malicious validator.</div></dd></dl></div></div></li><li><div class="item function"><span id="reportMalicious" class="anchor-marker"></span><h4 class="name">reportMalicious</h4><div class="body"><code class="signature">function <strong>reportMalicious</strong><span>(address _maliciousMiningAddress, uint256 _blockNumber, bytes ) </span><span>external </span></code><hr/><div class="description"><p>Reports that the malicious validator misbehaved at the specified block. Called by the node of each honest validator after the specified validator misbehaved. See https://wiki.parity.io/Validator-Set.html#reporting-contract Can only be called when the `reportMaliciousCallable` getter returns `true`.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_maliciousMiningAddress</code> - The mining address of the malicious validator.</div><div><code>_blockNumber</code> - The block number where the misbehavior was observed.</div><div><code></code> - bytes</div></dd></dl></div></div></li><li><div class="item function"><span id="reportMaliciousCallable" class="anchor-marker"></span><h4 class="name">reportMaliciousCallable</h4><div class="body"><code class="signature">function <strong>reportMaliciousCallable</strong><span>(address _reportingMiningAddress, address _maliciousMiningAddress, uint256 _blockNumber) </span><span>public </span><span>view </span><span>returns  (bool, bool) </span></code><hr/><div class="description"><p>Returns whether the `reportMalicious` function can be called by the specified validator with the given parameters. Used by the `reportMalicious` function and `TxPermission` contract. Also, returns a boolean flag indicating whether the reporting validator should be removed as malicious due to excessive reporting during the current staking epoch.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_reportingMiningAddress</code> - The mining address of the reporting validator which is calling the `reportMalicious` function.</div><div><code>_maliciousMiningAddress</code> - The mining address of the malicious validator which is passed to the `reportMalicious` function.</div><div><code>_blockNumber</code> - The block number which is passed to the `reportMalicious` function.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>removeReportingValidator The boolean flag indicating whether the reporting validator should be removed as malicious due to excessive reporting. This flag is only used by the `reportMalicious` function.</dd></dl></div></div></li><li><div class="item function"><span id="reportingCounter" class="anchor-marker"></span><h4 class="name">reportingCounter</h4><div class="body"><code class="signature">function <strong>reportingCounter</strong><span>(address _reportingMiningAddress, uint256 _stakingEpoch) </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns the number of times the specified validator reported misbehaviors during the specified staking epoch. Used by the `reportMaliciousCallable` getter to determine whether a validator reported too often.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_reportingMiningAddress</code> - The mining address of the reporting validator.</div><div><code>_stakingEpoch</code> - The serial number of the staking epoch.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li><li><div class="item function"><span id="reportingCounterTotal" class="anchor-marker"></span><h4 class="name">reportingCounterTotal</h4><div class="body"><code class="signature">function <strong>reportingCounterTotal</strong><span>(uint256 _stakingEpoch) </span><span>public </span><span>view </span><span>returns  (uint256) </span></code><hr/><div class="description"><p>Returns how many times all validators reported misbehaviors during the specified staking epoch. Used by the `reportMaliciousCallable` getter to determine whether a validator reported too often.</p></div><dl><dt><span class="label-parameters">Parameters:</span></dt><dd><div><code>_stakingEpoch</code> - The serial number of the staking epoch.</div></dd><dt><span class="label-return">Returns:</span></dt><dd>uint256</dd></dl></div></div></li></ul></div></div></div>
